<header class="d-flex justify-content-between align-items-center p-3 bg-primary text-white">
  <h1>Create Document</h1>
</header>

<div class="container mt-4 p-3 mb-3">
  <div class="p-3 mb-3">
  <div>
    <input class="form-control mb-2" [(ngModel)]="document.code" placeholder="Document code (ex. DOC-001)">
  </div>

    <h3>Add Items</h3>
    <select class="form-select mb-2" #article>
      <option value="" disabled selected>Select an article</option>
      <option *ngFor="let a of articles" [value]="a.id">{{ a.name }}</option>
    </select>
    <input #qty type="number" placeholder="Quantity" class="form-control mb-2">

    <select class="form-select mb-2" [(ngModel)]="document.from_location_id" name="from">
      <option value="" disabled selected>From Location</option>
      <option *ngFor="let loc of locations" [value]="loc.id">{{ loc.name }}</option>
    </select>

    <select class="form-select mb-2" [(ngModel)]="document.to_location_id" name="to">
      <option value="" disabled selected>To Location</option>
      <option *ngFor="let loc of locations" [value]="loc.id">{{ loc.name }}</option>
    </select>

    <button class="btn btn-success mb-3" (click)="addItem(+article.value, +qty.value)">Add Item</button>
    <label class="p-3">Multiple items can be added!</label>
  </div>

  <button class="btn btn-primary" (click)="reloadPage()" (click)="createDocument()">Create Document</button>
</div>

<div *ngIf="isLoggedIn()">
  <h3>Existing Documents</h3>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Code</th>
        <th>Created</th>
        <th>Status</th>
        <th>Confirmed Date</th>
        <th>Confirmed By</th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      <ng-container *ngFor="let d of documents">
        <!-- Document row -->
        <tr (click)="d.showItems = !d.showItems" style="cursor:pointer;">
          <td>{{ d.code }}</td>
          <td>{{ d.created_date | date:'short' }}</td>
          <td [ngStyle]="{'background-color': d.status==='CONFIRMED' ? '#a2f6a2' : '#faabab'}">
            {{ d.status }}
          </td>
          <td>{{ d.confirmed_date ? (d.confirmed_date | date:'short') : '-' }}</td>
          <td>{{ d.confirmed_by_email || '-' }}</td>
          <td>
            <button *ngIf="d.status === 'NOT CONFIRMED'" class="btn btn-sm btn-warning"
              (click)="confirmExisting(d.id); $event.stopPropagation();">
              Confirm
            </button>
          </td>
        </tr>

        <!-- Items row -->
        <tr *ngIf="d.showItems">
          <td colspan="6">
            <h5>Items in {{ d.code }}:</h5>
            <table class="table table-sm table-bordered mb-0">
              <thead>
                <tr>
                  <th>Article</th>
                  <th>From Location</th>
                  <th>To Location</th>
                  <th>Quantity</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of d.items">
                  <td>{{ item.article_name }}</td>
                  <td>{{ item.from_location_name }}</td>
                  <td>{{ item.to_location_name }}</td>
                  <td>{{ item.quantity }}</td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>
</div>